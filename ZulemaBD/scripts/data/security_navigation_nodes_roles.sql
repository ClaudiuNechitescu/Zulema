

BEGIN TRY

MERGE INTO [Security_Navigation_Nodes_Roles] AS Target
USING (VALUES
  (N'1BF27F47-4D13-4F55-9ADF-0C9D4FD232BE',N'admins',0,1)
 ,(N'1BF27F47-4D13-4F55-9ADF-0C9D4FD232BE',N'allUsers',0,1)
 ,(N'1BF27F47-4D13-4F55-9ADF-0C9D4FD232BE',N'especialistas',0,1)
 ,(N'1BF27F47-4D13-4F55-9ADF-0C9D4FD232BE',N'notRegistered',0,1)
 ,(N'1BF27F47-4D13-4F55-9ADF-0C9D4FD232BE',N'pacientes',1,1)
 ,(N'1BF27F47-4D13-4F55-9ADF-0C9D4FD232BE',N'registered',0,1)
 ,(N'1BF27F47-4D13-4F55-9ADF-0C9D4FD232BE',N'users',0,1)
 ,(N'45A08EF6-4CE3-4E10-B021-188AB7A120D2',N'admins',0,1)
 ,(N'45A08EF6-4CE3-4E10-B021-188AB7A120D2',N'allUsers',0,1)
 ,(N'45A08EF6-4CE3-4E10-B021-188AB7A120D2',N'especialistas',0,1)
 ,(N'45A08EF6-4CE3-4E10-B021-188AB7A120D2',N'notRegistered',0,1)
 ,(N'45A08EF6-4CE3-4E10-B021-188AB7A120D2',N'pacientes',1,1)
 ,(N'45A08EF6-4CE3-4E10-B021-188AB7A120D2',N'registered',0,1)
 ,(N'45A08EF6-4CE3-4E10-B021-188AB7A120D2',N'users',0,1)
 ,(N'ECC37505-957A-4FEB-839B-1BDA01971A12',N'admins',0,1)
 ,(N'ECC37505-957A-4FEB-839B-1BDA01971A12',N'allUsers',0,1)
 ,(N'ECC37505-957A-4FEB-839B-1BDA01971A12',N'especialistas',0,1)
 ,(N'ECC37505-957A-4FEB-839B-1BDA01971A12',N'notRegistered',0,1)
 ,(N'ECC37505-957A-4FEB-839B-1BDA01971A12',N'pacientes',1,1)
 ,(N'ECC37505-957A-4FEB-839B-1BDA01971A12',N'registered',0,1)
 ,(N'ECC37505-957A-4FEB-839B-1BDA01971A12',N'users',0,1)
 ,(N'617FD855-FAED-41BC-A816-35E991CFA16F',N'admins',1,1)
 ,(N'617FD855-FAED-41BC-A816-35E991CFA16F',N'allUsers',0,1)
 ,(N'617FD855-FAED-41BC-A816-35E991CFA16F',N'especialistas',1,1)
 ,(N'617FD855-FAED-41BC-A816-35E991CFA16F',N'notRegistered',0,1)
 ,(N'617FD855-FAED-41BC-A816-35E991CFA16F',N'pacientes',0,1)
 ,(N'617FD855-FAED-41BC-A816-35E991CFA16F',N'registered',0,1)
 ,(N'617FD855-FAED-41BC-A816-35E991CFA16F',N'users',0,1)
 ,(N'C0811437-4A3A-4834-91E6-4AF43E6B2596',N'admins',0,1)
 ,(N'64BD8171-B0A8-4ECC-90CD-5663580B1D0C',N'admins',1,1)
 ,(N'64BD8171-B0A8-4ECC-90CD-5663580B1D0C',N'allUsers',0,1)
 ,(N'64BD8171-B0A8-4ECC-90CD-5663580B1D0C',N'especialistas',1,1)
 ,(N'64BD8171-B0A8-4ECC-90CD-5663580B1D0C',N'notRegistered',0,1)
 ,(N'64BD8171-B0A8-4ECC-90CD-5663580B1D0C',N'pacientes',1,1)
 ,(N'64BD8171-B0A8-4ECC-90CD-5663580B1D0C',N'registered',0,1)
 ,(N'64BD8171-B0A8-4ECC-90CD-5663580B1D0C',N'users',0,1)
 ,(N'1B7AE3DA-3572-447E-8527-5A524D3A739E',N'admins',1,1)
 ,(N'1B7AE3DA-3572-447E-8527-5A524D3A739E',N'allUsers',0,1)
 ,(N'1B7AE3DA-3572-447E-8527-5A524D3A739E',N'especialistas',1,1)
 ,(N'1B7AE3DA-3572-447E-8527-5A524D3A739E',N'notRegistered',0,1)
 ,(N'1B7AE3DA-3572-447E-8527-5A524D3A739E',N'pacientes',0,1)
 ,(N'1B7AE3DA-3572-447E-8527-5A524D3A739E',N'registered',0,1)
 ,(N'1B7AE3DA-3572-447E-8527-5A524D3A739E',N'users',0,1)
 ,(N'90EB5836-CF95-49EB-9F1A-5C5A712EA2D2',N'admins',1,1)
 ,(N'90EB5836-CF95-49EB-9F1A-5C5A712EA2D2',N'allUsers',0,1)
 ,(N'90EB5836-CF95-49EB-9F1A-5C5A712EA2D2',N'especialistas',1,1)
 ,(N'90EB5836-CF95-49EB-9F1A-5C5A712EA2D2',N'notRegistered',0,1)
 ,(N'90EB5836-CF95-49EB-9F1A-5C5A712EA2D2',N'pacientes',0,1)
 ,(N'90EB5836-CF95-49EB-9F1A-5C5A712EA2D2',N'registered',0,1)
 ,(N'90EB5836-CF95-49EB-9F1A-5C5A712EA2D2',N'users',0,1)
 ,(N'6D67BF3C-956C-461D-84FE-6D7AC9FD8925',N'admins',0,1)
 ,(N'87221611-BA27-42FD-BAA8-79F4990EF81F',N'admins',1,1)
 ,(N'87221611-BA27-42FD-BAA8-79F4990EF81F',N'allUsers',0,1)
 ,(N'87221611-BA27-42FD-BAA8-79F4990EF81F',N'especialistas',1,1)
 ,(N'87221611-BA27-42FD-BAA8-79F4990EF81F',N'notRegistered',0,1)
 ,(N'87221611-BA27-42FD-BAA8-79F4990EF81F',N'pacientes',0,1)
 ,(N'87221611-BA27-42FD-BAA8-79F4990EF81F',N'registered',0,1)
 ,(N'87221611-BA27-42FD-BAA8-79F4990EF81F',N'users',0,1)
 ,(N'C3AC24E9-B555-4AD3-BA9D-890701BFA8F7',N'admins',0,1)
 ,(N'C3AC24E9-B555-4AD3-BA9D-890701BFA8F7',N'allUsers',0,1)
 ,(N'C3AC24E9-B555-4AD3-BA9D-890701BFA8F7',N'especialistas',0,1)
 ,(N'C3AC24E9-B555-4AD3-BA9D-890701BFA8F7',N'notRegistered',0,1)
 ,(N'C3AC24E9-B555-4AD3-BA9D-890701BFA8F7',N'pacientes',1,1)
 ,(N'C3AC24E9-B555-4AD3-BA9D-890701BFA8F7',N'registered',0,1)
 ,(N'C3AC24E9-B555-4AD3-BA9D-890701BFA8F7',N'users',0,1)
 ,(N'50B7A331-15B2-42A2-B62B-DAAE9345C493',N'admins',1,1)
 ,(N'50B7A331-15B2-42A2-B62B-DAAE9345C493',N'allUsers',0,1)
 ,(N'50B7A331-15B2-42A2-B62B-DAAE9345C493',N'especialistas',1,1)
 ,(N'50B7A331-15B2-42A2-B62B-DAAE9345C493',N'notRegistered',0,1)
 ,(N'50B7A331-15B2-42A2-B62B-DAAE9345C493',N'pacientes',0,1)
 ,(N'50B7A331-15B2-42A2-B62B-DAAE9345C493',N'registered',0,1)
 ,(N'50B7A331-15B2-42A2-B62B-DAAE9345C493',N'users',0,1)
) AS Source ([NodeId],[RoleId],[CanView],[OriginId])
ON (Target.[NodeId] = Source.[NodeId] AND Target.[RoleId] = Source.[RoleId])
WHEN MATCHED AND (
	NULLIF(Source.[CanView], Target.[CanView]) IS NOT NULL OR NULLIF(Target.[CanView], Source.[CanView]) IS NOT NULL OR 
	NULLIF(Source.[OriginId], Target.[OriginId]) IS NOT NULL OR NULLIF(Target.[OriginId], Source.[OriginId]) IS NOT NULL) THEN
 UPDATE SET
  [CanView] = Source.[CanView], 
  [OriginId] = Source.[OriginId]
WHEN NOT MATCHED BY TARGET THEN
 INSERT([NodeId],[RoleId],[CanView],[OriginId])
 VALUES(Source.[NodeId],Source.[RoleId],Source.[CanView],Source.[OriginId])
WHEN NOT MATCHED BY SOURCE AND TARGET.OriginId = 1 THEN 
 DELETE
;
END TRY
BEGIN CATCH
    DECLARE @ERRORNUMBER	INT,@ERRORMSG		VARCHAR(MAX),@ERRORSTATE		INT
    SELECT @ERRORNUMBER = 50000 + ERROR_NUMBER(),@ERRORMSG = ERROR_MESSAGE(), @ERRORSTATE = ERROR_STATE();
    THROW @ERRORNUMBER, @ERRORMSG, @ERRORSTATE
END CATCH
GO





